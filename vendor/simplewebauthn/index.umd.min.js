(function(g,f){typeof exports==="object"&&typeof module!="undefined"?module.exports=f():typeof define==="function"&&define.amd?define(f):(g.SimpleWebAuthnBrowser=f())})(this,function(){"use strict";function b64u(buf){try{var b=new Uint8Array(buf),s="";for(var i=0;i<b.length;i++)s+=String.fromCharCode(b[i]);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,'')}catch(e){return""}}function u8(b64){try{if(!b64)return new Uint8Array(0);var s=String(b64).replace(/-/g,"+").replace(/_/g,"/");var pad=s.length%4?4-(s.length%4):0;if(pad)s+=Array(pad+1).join('=');var bin=atob(s),u=new Uint8Array(bin.length);for(var i=0;i<bin.length;i++)u[i]=bin.charCodeAt(i);return u}catch(e){return new Uint8Array(0)}}async function startAuthentication(opts,add){if(!opts)throw new Error("opts required");var publicKey=opts.publicKey||opts;try{if(publicKey.challenge&&!(publicKey.challenge.buffer))publicKey.challenge=u8(publicKey.challenge)}catch(e){}try{if(Array.isArray(publicKey.allowCredentials)){publicKey.allowCredentials=publicKey.allowCredentials.map(function(c){return Object.assign({},c,{id:(c&&c.id&&c.id.buffer)?c.id:u8(c.id)})})}}catch(e){}var getOpts=add&&add.mediation?{publicKey:publicKey,mediation:add.mediation}:{publicKey:publicKey};var cred=await navigator.credentials.get(getOpts);if(!cred)throw new Error("no credential");var resp=cred.response||{};return {id:cred.id,rawId:b64u(cred.rawId),type:cred.type,response:{authenticatorData:b64u(resp.authenticatorData),clientDataJSON:b64u(resp.clientDataJSON),signature:b64u(resp.signature),userHandle:resp.userHandle?b64u(resp.userHandle):null},clientExtensionResults:(cred.getClientExtensionResults?cred.getClientExtensionResults():{})}}return {startAuthentication:startAuthentication};});
